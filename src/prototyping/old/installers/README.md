# Installers

## Packaged Installer

This project uses the WiX installer for Visual Studio 2022 to create an MSI setup

WiX:
https://wixtoolset.org/releases/

Extension for Visual Studio 2022
https://marketplace.visualstudio.com/items?itemName=WixToolset.WixToolsetVisualStudio2022Extension

## Installer notes

This is also useful for manual installers by developers

### Required registry keys

The main registry key is `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MIDI\` . Not much is stored in there, but
it's used to allow the user to change the location of the storage used by the service.

If this value doesn't exist, MIDI Services will attempt to write it, but will fail due to it being HKLM. It really needs to be created by the installer.

```csharp
[HKEY_LOCAL_MACHINE\Software\Microsoft\MIDI]
"MainConfig"="%ALLUSERSPROFILE%\\Microsoft\\MIDI\\MainConfig.midiconfig.json"
```

It's important that that location be somewhere that Local System (or other account if the service is running under that) can write to.

### Required folders

Root = %ALLUSERSPROFILE%\\Microsoft Windows MIDI\\

When you create this folder, you must assign ACL to it (and subfolders) to allow `Local System` and either the specific user or authenticated users full CRUD access.

* Default app folder `[root]`
* Setups folder `[root]\Setups`
* Icons folder `[root]\Icons`
* Plugins folder `[root]\Plugins` (currently evaluating if this is the right place for these, or if we should have them in common files or similar)

### Required additional files and folders

(You can double-check these paths in the `src\shared\config` project)

Copy MainConfig.midiconfig.json to default app folder and verify path matches reg value. This will be generated by the service if the file is already there.

Copy Default.midisetup.json to the Setups folder

Copy icons to the Icons folder

Once the main config file is found, all other paths are stored in the config file, so as to avoid a
huge dependency on registry values.
